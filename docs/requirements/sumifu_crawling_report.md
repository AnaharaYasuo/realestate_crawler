# Sumifu クローリング API 実行状況報告書（更新版）

## 概要
住友不動産販売（Sumifu）のクローリング状況を検証した結果、一部の機能は正常に動作していますが、特定の物件種別における保存失敗や、システム全体に関わるモデル実装の重大な不具合が確認されました。

## 解消済みの事項
以下の項目については、実装および動作を確認済みです。
- **リトライ機能**: `baseParser.py` における接続エラー時の指数バックオフ付きリトライ。
- **DB文字コード**: `realestateSettings.py` における `utf8mb4` の適用。
- **マンション**: 2312件（正常動作確認済み）。
- **土地**: 534件（巡回中、日本語表示正常）。

## 現在発生している未解消の問題点

### 1. 戸建（Kodate）の保存失敗（IntegrityError）
- **現象**: クローリングログに `IntegrityError: (1048, "Column 'chikunengetsu' cannot be null")` が頻発し、データベースに1件も保存されていない。
- **原因**: 詳細ページからの築年月（`chikunengetsu`）の取得またはパースに失敗し、DBの非NULL制約に抵触している。
- **対応**: `SumifuKodateParser` において、取得できない場合にデフォルト値（1900-01-01）をセットするフォールバックを実装（修正済み）。

### 2. モデル初期化のバグによるデータ消失
- **現象**: データベースに保存されているはずのデータが、Django ORM で取得すると空文字（`""`）として表示される。
- **原因**: `package/models/sumifu.py` 内の各モデルクラスで `__init__` がオーバーライドされており、インスタンス化時に DB からの読み込み値を空文字で上書きしているため。
- **対応**: モデルクラスの `__init__` メソッドをすべて削除（修正済み）。

### 3. 投資用物件（Investment）の取得件数 0件
- **現象**: クローリングを開始してもデータベースにレコードが増えない。
- **原因**: 上記モデルバグの影響または、パーサーのセレクタが現在のサイト構造に不適合である可能性。
- **現在の対応**: 調査およびパーサーの修正が必要。

---
最終更新日: 2026年1月12日
ステータス: **要修正・検証継続中**
