# 投資用物件の種別定義と判定ロジック

本ドキュメントでは、不動産投資における「戸建」および「アパート」の定義と、クローラにおける各社の判定仕様を定義する。

## 1. 共通定義

不動産投資ドメインにおいて、本システムが対象とする「戸建」と「アパート」は以下の通り定義する。

| 物件種別 | 定義 | 備考 |
| :--- | :--- | :--- |
| **戸建 (Kodate)** | 一戸建ての住宅を一棟丸ごと貸し出す投資形態。 | 「一棟戸建」とも呼ばれる。 |
| **アパート (Apartment)** | 木造や軽量鉄骨造の集合住宅（通常2〜3階建て）を建物丸ごと一棟貸し出す投資形態。 | 「一棟アパート」が対象であり、1部屋のみの区分所有は含まない。 |

> [!IMPORTANT]
> 「区分マンション（Mansion）」は本定義には含まれず、別途「マンション」として管理する。

## 2. 各社サイトの判定・絞り込みロジック

### 三井のリハウス (Mitsui)
三井のリハウス（投資・事業用）では、URLパラメータ `buildingTypes` を使用して物理的に絞り込む。

*   **戸建**: `buildingTypes=4`
*   **アパート**: `buildingTypes=2`
*   ※補足: `1`: 一棟ビル, `3`: 一棟マンション

### 住友不動産ステップ (Sumifu)
検索URLの `smk` パラメータ（12桁のビットマスク）を使用して絞り込む。

*   **アパート**: `smk=010000000000` (左から2本目のビット)
*   **戸建**: `smk=000000100000` (左から7本目のビット)

### 野村の仲介＋ (Nomura)
URLのディレクトリパスによって物理的に分離されているため、特定のパスに限定して取得する。

*   **アパート**: `/pro/apart/` のパスを含むURLのみ。
*   **戸建**: `/pro/house/` のパスを含むURLのみ。

### 東急リバブル (Tokyu)
URLパラメータ `conditions-use` を使用して絞り込む。

*   **アパート**: `conditions-use=apart`
*   **戸建**: `conditions-use=kodate`

### ミサワホーム (Misawa)
一覧ページでは投資物件が混在して出力されるため、詳細ページの「物件種目」またはそれに類するラベルを確認して動的に判定する。

*   **判定対象ラベル**: 「物件種目」
*   **アパート**: ラベルが「一棟アパート」「アパート」などの場合。
*   **戸建**: ラベルが「戸建」「一戸建て」などの場合。

---

## 3. 実装ガイドライン

1.  **URLによる絞り込み**: 可能な限り、開始URLの時点でパラメータを指定して不要な物件が紛れ込まないようにする。
2.  **パーサーでの検証**: ミサワホームのような絞り込みが不十分なサイトでは、パーサー内で必ずラベルチェックを行い、期待する種別でない場合は `ReadPropertyNameException` などをスローするか、スキップする。
3.  **モデルの不一致**: 物件種別が判明した時点で、対応するモデル（`Kodate` か `Apartment`）にマッピングする。
