---
trigger: always_on
---

# Common Rules

## ドキュメント・成果物
- `implementation_plan.md` は必ず日本語で出力する。
- `walkthrough.md` は必ず日本語で出力する。
- 実装や設計の際は `docs/` 配下のドキュメント（仕様書、DBスキーマ、サイト構造など）を常に参照し、最新の仕様に準拠する。
- コードを修正したらかならずdocsやREADMEを最新のコードに合わせて修正する。
- モデル（`package/models/*.py`）を変更したら、必ず [docs/database_schema.md](/realestate_crawler/docs/database_schema.md) を更新すること。なお、フィールドの追加・削除・型変更・NULL制約変更など、すべてのモデル変更を反映する。
- **`docs/` フォルダにドキュメントを追加・修正・削除したら、必ず [README.md](/realestate_crawler/README.md) の「ドキュメント一覧」セクションを更新すること。**
  - ドキュメント名とリンクを追加
  - 適切な分類（🚀入門ガイド・📐技術仕様書・🛠️開発ガイド・🔧運用）に配置
  - 簡潔な説明を記載
  - 詳細は [docs/documentation_guidelines.md](/realestate_crawler/docs/documentation_guidelines.md) を参照

## 開発・実行プロセス
- 一時的に使用する作業用のコードは Temp フォルダに出力する。
- ブラウザを開いて対象のサイトを読み込む作業をする場合、不要なメモリ消費を避けるためにその作業が終わったら必ずそのタブを閉じること。
- **開発・検証プロセス**:
    パーサーの開発、修正、および修正後の動作確認（エラーHTML検証、実機検証、DB確認）は、[パーサー実装手順ガイドライン](docs/implementation/parser_implementation_procedure.md) に規定された手順に厳格に従うこと。
- コードを修正したら必ずローカルでテストを実行し、全て成功するようにする。それまで絶対にGitHubにプッシュしない。
- 変更がGitHubにマージされたら、そのフィーチャーブランチはもう利用しない。ローカルブランチはマスターに変更し、マージされた変更を取り込む。
- **Pythonを動かす場合には必ずDockerを起動して、そのコンテナ内で実施すること（例: `docker-compose exec -T app python ...`）。**

## DB操作
- DBのテーブルやデータ削除は事前確認の実施を必須とする。

## 問題解決・ログ出力
- 意図しない問題が発生した際に、問題が発生した原因に対して仮説を構築し対応することになるが、構築した仮説が正しいことを必ず確認してから原因対処を行う。
- 単なる仮説には価値はないので、その仮説は必ず裏付けを行う。
- 問題の特定には事実の収集が重要なので、ログに出力する情報は十分なものにする。
- 問題特定に必要な情報がログに出力されていない場合、ログに出力する情報を拡充する。

## ルール管理
- くりかえしてユーザーから同じ指摘を受けた場合、その指示は重要な指示と考えてルールとして保存する。
- 起こした問題の解決方法も都度ルールに追記する。

## パーサー実装・モデル設計
- **実装ガイドラインの遵守**: パーサーの実装（ラベル起点抽出、フォールバックの扱い、検証プロセス等）については、[パーサー実装手順ガイドライン](docs/implementation/parser_implementation_procedure.md) に規定された手順に厳格に従うこと。
- **フィールド名の統一**: サイトが異なっていても、同じ情報を保持する項目は、モデル定義およびパーサー実装において必ず同一のフィールド名を使用する。詳細は [フィールド名統一規約](docs/internal_design/field_naming_standards.md) を正として遵守すること。

## パーサー検証・品質保証
- 全サイト全物件種別でデータを取得できるようにすること。
- 検証手順、エラーHTMLの取扱い、品質基準については [パーサー実装手順ガイドライン](docs/implementation/parser_implementation_procedure.md) に従うこと。
- ログには詳細なエラー情報が出力されるようにすること。